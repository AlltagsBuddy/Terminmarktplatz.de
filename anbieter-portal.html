<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mein Portal ‚Äì Profil & Slots | Terminmarktplatz</title>
  <meta name="description" content="Anbieter-Portal: Profil pflegen, freie Zeitfenster/Slots anlegen, verwalten und ver√∂ffentlichen." />
  <meta name="theme-color" content="#6f53ff" />
  <base href="/">

  <!-- OG/Twitter minimal -->
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="Anbieter-Portal | Terminmarktplatz"/>
  <meta property="og:image" content="static/og-cover.png"/>
  <meta name="twitter:card" content="summary_large_image"/>

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YNZ8GW523R"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-YNZ8GW523R');
  </script>

  <!-- Assets -->
  <link rel="icon" href="static/favicon.png"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@400;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="static/style.css?v=20251010"/>

  <style>
    .page-portal .panel{border-radius:var(--r-3xl); box-shadow:var(--shadow-2)}
    .grid{display:grid; gap:16px}
    @media(min-width: 920px){ .grid-2{grid-template-columns:1fr 1fr} }

    /* Formular */
    .field{ display:flex; flex-direction:column; gap:6px; background:rgba(255,255,255,.04);
            border:1px solid var(--border); border-radius:12px; padding:10px; }
    .field input,.field select,.field textarea{
      background:#fff; color:#0f172a; border:1px solid rgba(15,23,42,.28);
      border-radius:12px; padding:10px; box-shadow: inset 0 1px 0 rgba(0,0,0,.03);
    }
    .field input::placeholder,.field textarea::placeholder{ color:#64748b }
    .field input:focus,.field select:focus,.field textarea:focus{
      outline:none; border-color:#60a5fa; box-shadow:0 0 0 3px rgba(59,130,246,.25)
    }
    .req{ color:#ef4444; font-weight:700 }

    .muted{color:var(--ink-dim)}
    .toolbar{display:flex; gap:10px; align-items:center; flex-wrap:wrap}

    /* Tabelle */
    .table{width:100%; border-collapse:collapse; border:1px solid var(--border);
           border-radius:14px; overflow:hidden}
    .table th,.table td{padding:10px 12px; border-bottom:1px solid var(--border); text-align:left}
    .table th{background:#f8fafc; color:#0f172a}
    .table th:first-child,.table td:first-child{ text-align:center; width:34px }

    .badge-st{padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border)}
    .st-pending{background:#fff7ed}
    .st-pub{background:#ecfeff}
    .st-arch{background:#f1f5f9}

    .msg{display:none; padding:10px; border-radius:12px; margin-top:8px}
    .msg.ok{display:block; background:#dcfce7; color:#065f46; border:1px solid #16a34a}
    .msg.err{display:block; background:#fee2e2; color:#7f1d1d; border:1px solid #ef4444}

    .seg{margin:4px 0 0; display:flex; gap:8px; flex-wrap:wrap}
    .seg .btn{padding:6px 10px}
    .nowrap{white-space:nowrap}

    /* Buttons in der Slot-Tabelle */
    .table .btn{
      padding:8px 12px; border:none; border-radius:12px; font-weight:800;
      background: var(--border); color:#0b0f1a; box-shadow: var(--shadow-1);
      transition: transform .15s, filter .15s;
    }
    .table .btn:hover{ transform: translateY(-1px); filter: brightness(1.05); }
    .table .btn.action{ background: var(--border); }
    .table .btn.danger{ background: var(--border); }

    /* Deaktivierte Bulk-Buttons */
    .seg .btn[disabled]{ opacity:.55; pointer-events:none; }
  </style>
</head>
<body class="page-portal">

  <!-- Header -->
  <header>
    <div class="container nav">
      <a class="brand" href="index.html">
        <div class="brand-logo"><img src="static/terminmarktplatz-logo.png" alt="Logo" width="50" height="50"></div>
        <div class="brand-title">Terminmarktplatz</div>
      </a>
      <nav class="nav-links">
        <a href="anbieter.html">F√ºr Anbieter</a>
        <a href="suchende.html">F√ºr Suchende</a>
        <a href="preise.html">Preise</a>
      </nav>
      <div class="cta-group">
        <button id="btn-logout" class="btn">Abmelden</button>
      </div>
    </div>
  </header>

  <main>
    <!-- HERO -->
    <section class="hero" style="padding:36px 0 18px">
      <div class="container">
        <span class="badge">Anbieter-Portal</span>
        <h1>Willkommen! üëã</h1>
        <p class="lead">Pflege hier dein <strong>Profil</strong> und lege <strong>freie Slots</strong> an.
          Neue Slots starten als <em>‚Äûpending_review‚Äú</em>. Nach deiner Best√§tigung werden sie ver√∂ffentlicht.</p>
      </div>
    </section>

    <!-- CONTENT -->
    <section>
      <div class="container grid grid-2">

        <!-- Profil -->
        <div class="panel">
          <h2>Profil</h2>
          <p class="muted">Diese Daten sieht der/die Kund:in bei deinen Angeboten.</p>
          <form id="form-profile" class="grid">
            <div class="field">
              <label for="pf-company">Firma / Praxis / Studio <span class="req">*</span></label>
              <input id="pf-company" name="company_name" placeholder="z. B. Salon Mira" required/>
            </div>
            <div class="field">
              <label for="pf-branch">Branche <span class="req">*</span></label>
              <input id="pf-branch" name="branch" list="branch-list" placeholder="z. B. Friseur" required/>
              <datalist id="branch-list">
                <option>Friseur</option><option>Kosmetik</option><option>Physiotherapie</option>
                <option>Nagelstudio</option><option>Zahnarzt</option><option>Handwerk</option>
                <option>KFZ-Service</option><option>Fitness</option><option>Coaching</option>
                <option>Tierarzt</option><option>Beh√∂rde</option><option>Sonstiges</option>
              </datalist>
            </div>
            <div class="field">
              <label for="pf-street">Stra√üe & Nr.</label>
              <input id="pf-street" name="street" placeholder="Musterstra√üe 1"/>
            </div>
            <div class="field">
              <label for="pf-zip">PLZ <span class="req">*</span></label>
              <input id="pf-zip" name="zip" placeholder="12345" pattern="\d{5}" inputmode="numeric" required/>
            </div>
            <div class="field">
              <label for="pf-city">Ort <span class="req">*</span></label>
              <input id="pf-city" name="city" placeholder="Musterstadt" required/>
            </div>
            <div class="field">
              <label for="pf-phone">Telefon</label>
              <input id="pf-phone" name="phone" placeholder="+49 ‚Ä¶" pattern="^\+?[0-9\s\-\/]{6,}$"/>
            </div>
            <div class="field">
              <label for="pf-whatsapp">WhatsApp (optional)</label>
              <input id="pf-whatsapp" name="whatsapp" placeholder="+49 ‚Ä¶" pattern="^\+?[0-9\s\-\/]{6,}$"/>
            </div>
            <div class="toolbar">
              <button class="btn primary" type="submit">Profil speichern</button>
              <span class="muted">Tipp: Firma, Branche, PLZ & Ort ausf√ºllen.</span>
            </div>
            <div id="msg-profile" class="msg"></div>
          </form>
        </div>

        <!-- Slot anlegen -->
        <div class="panel">
          <h2>Neuen Slot anlegen</h2>
          <form id="form-slot" class="grid">
            <div class="field">
              <label for="sl-title">Titel <span class="req">*</span></label>
              <input id="sl-title" name="title" placeholder="z. B. Damenhaarschnitt" required/>
            </div>

            <!-- Kategorie: Dropdown (DB-konform) -->
            <div class="field">
              <label for="sl-cat">Kategorie <span class="req">*</span></label>
              <select id="sl-cat" name="category" required>
                <option value="" disabled selected>Bitte w√§hlen ‚Ä¶</option>
              </select>
            </div>

            <div class="field">
              <label for="sl-date">Datum <span class="req">*</span></label>
              <input id="sl-date" type="date" required/>
            </div>
            <div class="field">
              <label for="sl-start">Start (Uhrzeit) <span class="req">*</span></label>
              <input id="sl-start" type="time" step="60" required/>
            </div>

            <div class="field">
              <label for="sl-duration">Dauer (Minuten) <span class="req">*</span></label>
              <input id="sl-duration" type="number" min="5" step="5" value="30" required/>
              <div class="seg">
                <button type="button" class="btn" data-min="15">15</button>
                <button type="button" class="btn" data-min="30">30</button>
                <button type="button" class="btn" data-min="45">45</button>
                <button type="button" class="btn" data-min="60">60</button>
                <button type="button" class="btn" data-min="90">90</button>
              </div>
            </div>

            <div class="field">
              <label for="sl-end">Ende (berechnet)</label>
              <input id="sl-end" type="time" readonly/>
            </div>

            <div class="field">
              <label for="sl-location">Ort / Raum</label>
              <input id="sl-location" name="location" placeholder="z. B. Filiale Zentrum"/>
            </div>
            <div class="field">
              <label for="sl-cap">Kapazit√§t</label>
              <input id="sl-cap" type="number" min="1" step="1" value="1"/>
            </div>
            <div class="field">
              <label for="sl-price">Preis (Euro, optional)</label>
              <input id="sl-price" type="number" min="0" step="1" placeholder="z. B. 49"/>
            </div>
            <div class="field" style="grid-column:1/-1">
              <label for="sl-notes">Notizen (intern)</label>
              <textarea id="sl-notes" rows="2" placeholder="optional"></textarea>
            </div>

            <div class="toolbar">
              <button class="btn primary" type="submit">Slot anlegen</button>
              <span class="muted">Status: <span class="badge-st st-pending">pending_review</span></span>
            </div>
            <div id="msg-slot" class="msg"></div>
          </form>
        </div>

        <!-- Meine Slots -->
        <div class="panel" style="grid-column:1/-1">
          <div class="toolbar" style="justify-content:space-between">
            <h2 style="margin:0">Meine Slots</h2>
            <div class="seg">
              <label class="check" style="color:#fff">
                <input type="checkbox" id="chk-all"> Alle ausw√§hlen
              </label>
              <button class="btn action" id="btn-publish" disabled>Ausgew√§hlte ver√∂ffentlichen</button>
              <button class="btn" id="btn-archive" disabled>Archivieren</button>
              <button class="btn danger" id="btn-delete" disabled>L√∂schen</button>
              <button class="btn" id="btn-refresh">Aktualisieren</button>
            </div>
          </div>

          <div class="muted" style="margin:6px 0 12px">
            Hinweis: Neue Slots werden zun√§chst als <em>‚Äûpending_review‚Äú</em> angelegt. Nach deiner Best√§tigung werden sie ver√∂ffentlicht.
          </div>

          <div class="table-wrap">
            <table class="table" id="tbl-slots">
              <thead>
                <tr>
                  <th>‚úì</th>
                  <th>Start</th>
                  <th>Ende</th>
                  <th>Titel</th>
                  <th>Kategorie</th>
                  <th class="nowrap">Ort</th>
                  <th>Kap.</th>
                  <th>Status</th>
                  <th class="nowrap">Aktionen</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="9" class="muted">Lade ‚Ä¶</td></tr>
              </tbody>
            </table>
          </div>
          <div id="msg-slots" class="msg"></div>
        </div>

      </div>
    </section>
  </main>

  <script>
    // ---------- API-Basis ----------
    const API = (()=> {
      const h = location.hostname;
      if (h === 'localhost' || h === '127.0.0.1') return 'http://127.0.0.1:5000';
      return 'https://api.terminmarktplatz.de';
    })();

    const $  = (q, root=document)=>root.querySelector(q);
    const $$ = (q, root=document)=>Array.from(root.querySelectorAll(q));

    function showMsg(id, text, ok=false){
      const el = document.getElementById(id);
      el.className = 'msg ' + (ok ? 'ok' : 'err');
      el.textContent = text;
      el.style.display = 'block';
      setTimeout(()=>{ el.style.display='none'; }, ok ? 1800 : 4200);
    }

    function pad(n){ return n.toString().padStart(2,'0'); }
    function toLocalISO(dateLocal){ return new Date(dateLocal).toISOString(); }
    function joinDateTime(dateStr, timeStr){
      const [y,m,d] = dateStr.split('-').map(Number);
      const [hh,mm] = timeStr.split(':').map(Number);
      return new Date(y, (m-1), d, hh, mm, 0, 0);
    }
    function fmtLocal(dtStr){
      const d = new Date(dtStr);
      return `${pad(d.getDate())}.${pad(d.getMonth()+1)}.${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }

    // ---------- Kategorien (Dropdown) ----------
    // Muss exakt zu den DB-Vorgaben passen (CHECK-Constraint).
    const CATEGORIES = [
      "Friseur","Kosmetik","Physiotherapie","Nagelstudio","Zahnarzt",
      "Handwerk","KFZ-Service","Fitness","Coaching","Tierarzt","Beh√∂rde","Sonstiges"
    ];
    function fillCategoryOptions(){
      const sel = $('#sl-cat');
      if(!sel) return;
      sel.innerHTML = `<option value="" disabled selected>Bitte w√§hlen ‚Ä¶</option>`
        + CATEGORIES.map(c => `<option value="${c}">${c}</option>`).join('');
    }

    // ---------- Auth-Gate / Me ----------
    let ME = null;
    async function requireAuth(){
      const r = await fetch(`${API}/me`, {credentials:'include'});
      if(!r.ok){ location.href = 'login.html?tab=login'; return; }
      ME = await r.json();
      $('#pf-company').value = ME.company_name || '';
      $('#pf-branch').value  = ME.branch || '';
      $('#pf-street').value  = ME.street || '';
      $('#pf-zip').value     = ME.zip || '';
      $('#pf-city').value    = ME.city || '';
      $('#pf-phone').value   = ME.phone || '';
      $('#pf-whatsapp').value= ME.whatsapp || '';
    }

    // ---------- Profil speichern ----------
    $('#form-profile').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const payload = {
        company_name: $('#pf-company').value.trim(),
        branch:       $('#pf-branch').value.trim(),
        street:       $('#pf-street').value.trim(),
        zip:          $('#pf-zip').value.trim(),
        city:         $('#pf-city').value.trim(),
        phone:        $('#pf-phone').value.trim(),
        whatsapp:     $('#pf-whatsapp').value.trim(),
      };
      try{
        const r = await fetch(`${API}/me`, {
          method:'PUT',
          headers:{'Content-Type':'application/json'},
          credentials:'include',
          body: JSON.stringify(payload)
        });
        const data = await r.json().catch(()=> ({}));
        if(r.ok){
          showMsg('msg-profile','Gespeichert ‚úì', true);
        }else{
          const map = {
            unauthorized: 'Bitte erneut anmelden.',
            invalid_zip: 'PLZ muss 5-stellig sein.',
            db_constraint_error: 'Ung√ºltige/fehlende Felder (DB-Vorgaben).',
            db_error: 'Datenbankfehler.'
          };
          showMsg('msg-profile', map[data.error] || 'Konnte Profil nicht speichern.');
          if(r.status === 401) location.href = 'login.html?tab=login';
        }
      }catch(e){
        showMsg('msg-profile','Netzwerkfehler.');
      }
    });

    // ---------- Slot-Form: Dauer -> Ende berechnen ----------
    function recalcEnd(){
      const d = $('#sl-date').value, t = $('#sl-start').value, min = parseInt($('#sl-duration').value||'0',10);
      if(!d || !t || !min){ $('#sl-end').value=''; return; }
      const start = joinDateTime(d,t);
      const end = new Date(start.getTime() + min*60000);
      $('#sl-end').value = `${pad(end.getHours())}:${pad(end.getMinutes())}`;
    }
    $('#sl-date').addEventListener('change', recalcEnd);
    $('#sl-start').addEventListener('input', recalcEnd);
    $('#sl-duration').addEventListener('input', recalcEnd);
    $$('#form-slot .seg [data-min]').forEach(b=>b.addEventListener('click', ()=>{
      $('#sl-duration').value = b.dataset.min; recalcEnd();
    }));

    // ---------- Slots laden & rendern + Freigabe-Workflow ----------
    let SELECTED = new Set();

    function updateBulkButtons(items){
      const byId = Object.fromEntries(items.map(x => [x.id, x]));
      const ids = [...SELECTED];
      const any = ids.length > 0;
      const anyPending = ids.some(id => (byId[id]?.status === 'pending_review' || byId[id]?.status === 'archived'));
      const anyPub     = ids.some(id => byId[id]?.status === 'published');
      $('#btn-publish').disabled = !(any && anyPending);
      $('#btn-archive').disabled = !(any && anyPub);
      $('#btn-delete').disabled  = !any;
    }

    async function loadSlots(){
      const tbody = $('#tbl-slots tbody');
      tbody.innerHTML = `<tr><td colspan="9" class="muted">Lade ‚Ä¶</td></tr>`;
      SELECTED.clear(); $('#chk-all').checked = false;

      try{
        const r = await fetch(`${API}/slots`, {credentials:'include'});
        if(!r.ok){ tbody.innerHTML = `<tr><td colspan="9" class="muted">Bitte (erneut) anmelden.</td></tr>`; return; }
        const items = await r.json();
        if(!items.length){ tbody.innerHTML = `<tr><td colspan="9" class="muted">Noch keine Slots angelegt.</td></tr>`; return; }

        tbody.innerHTML = '';
        for(const s of items){
          const tr = document.createElement('tr');
          const isPending   = s.status === 'pending_review';
          const isPublished = s.status === 'published';
          const isArchived  = s.status === 'archived';
          const stClass = isPublished ? 'st-pub' : (isArchived ? 'st-arch' : 'st-pending');

          tr.innerHTML = `
            <td><input type="checkbox" class="row-check" data-id="${s.id}"></td>
            <td>${fmtLocal(s.start_at)}</td>
            <td>${fmtLocal(s.end_at)}</td>
            <td>${s.title}</td>
            <td>${s.category||''}</td>
            <td>${s.location||''}</td>
            <td>${s.capacity||1}</td>
            <td><span class="badge-st ${stClass}">${s.status}</span></td>
            <td class="nowrap">
              ${isPending || isArchived ? `<button class="btn action" data-arch="${s.id}" data-status="published">Ver√∂ffentlichen</button>` : ''}
              ${isPublished ? `<button class="btn" data-arch="${s.id}" data-status="archived">Archivieren</button>` : ''}
              <button class="btn danger" data-del="${s.id}">L√∂schen</button>
            </td>
          `;
          tbody.appendChild(tr);
        }

        // Zeilen-Checkboxen
        $$('#tbl-slots .row-check').forEach(cb => {
          cb.addEventListener('change', ()=>{
            const id = cb.dataset.id;
            if(cb.checked) SELECTED.add(id); else SELECTED.delete(id);
            updateBulkButtons(items);
          });
        });

        // Einzelaktionen
        $$('#tbl-slots [data-del]').forEach(b =>
          b.addEventListener('click', async ()=>{ await delSlot(b.dataset.del); await loadSlots(); })
        );
        $$('#tbl-slots [data-arch]').forEach(b =>
          b.addEventListener('click', async ()=>{ await setStatus(b.dataset.arch, b.dataset.status); await loadSlots(); })
        );

        // Master-Checkbox
        $('#chk-all').onchange = (e) => {
          SELECTED.clear();
          $$('#tbl-slots .row-check').forEach(cb => {
            cb.checked = e.target.checked;
            if(cb.checked) SELECTED.add(cb.dataset.id);
          });
          updateBulkButtons(items);
        };

        updateBulkButtons(items);
      }catch(e){
        tbody.innerHTML = `<tr><td colspan="9" class="muted">Fehler beim Laden.</td></tr>`;
      }
    }

    async function delSlot(id){
      if(!confirm('Diesen Slot wirklich l√∂schen?')) return;
      try{
        const r = await fetch(`${API}/slots/${id}`, {method:'DELETE', credentials:'include'});
        if(!r.ok) showMsg('msg-slots','Konnte Slot nicht l√∂schen.');
      }catch(e){ showMsg('msg-slots','Netzwerkfehler.'); }
    }
    async function setStatus(id, status){
      try{
        const r = await fetch(`${API}/slots/${id}`, {
          method:'PUT',
          headers:{'Content-Type':'application/json'},
          credentials:'include',
          body: JSON.stringify({status})
        });
        if(!r.ok) showMsg('msg-slots','Konnte Status nicht √§ndern.');
      }catch(e){ showMsg('msg-slots','Netzwerkfehler.'); }
    }

    // Bulk-Aktionen
    async function bulkSetStatus(ids, status){
      if(!ids.length) return;
      await Promise.all(ids.map(id =>
        fetch(`${API}/slots/${id}`, {
          method:'PUT',
          headers:{'Content-Type':'application/json'},
          credentials:'include',
          body: JSON.stringify({status})
        })
      ));
    }
    async function bulkDelete(ids){
      if(!ids.length) return;
      await Promise.all(ids.map(id =>
        fetch(`${API}/slots/${id}`, {method:'DELETE', credentials:'include'})
      ));
    }
    $('#btn-publish').addEventListener('click', async ()=>{
      const ids = [...SELECTED];
      await bulkSetStatus(ids, 'published'); await loadSlots();
    });
    $('#btn-archive').addEventListener('click', async ()=>{
      const ids = [...SELECTED];
      await bulkSetStatus(ids, 'archived'); await loadSlots();
    });
    $('#btn-delete').addEventListener('click', async ()=>{
      const ids = [...SELECTED];
      if(!ids.length) return;
      if(!confirm(`Diese ${ids.length} Slot(s) wirklich l√∂schen?`)) return;
      await bulkDelete(ids); await loadSlots();
    });
    $('#btn-refresh').addEventListener('click', loadSlots);

    // ---------- Slot anlegen ----------
    $('#form-slot').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const date = $('#sl-date').value, time = $('#sl-start').value, dur = parseInt($('#sl-duration').value||'0', 10);
      if(!date || !time || !dur){ return showMsg('msg-slot','Bitte Datum, Start und Dauer angeben.'); }
      const startLocal = joinDateTime(date,time);
      const endLocal   = new Date(startLocal.getTime() + dur*60000);

      const payload = {
        title: $('#sl-title').value.trim() || 'Slot',
        category: $('#sl-cat').value.trim() || 'Sonstiges',
        start_at: toLocalISO(startLocal),
        end_at: toLocalISO(endLocal),
        location: $('#sl-location').value.trim() || null,
        capacity: parseInt($('#sl-cap').value || '1',10),
        contact_method: 'mail',
        booking_link: null,
        price_cents: $('#sl-price').value ? Math.round(parseFloat($('#sl-price').value)*100) : null,
        notes: $('#sl-notes').value.trim() || null
      };

      try{
        const r = await fetch(`${API}/slots`, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          credentials:'include',
          body: JSON.stringify(payload)
        });
        const data = await r.json().catch(()=> ({}));
        if(r.ok){
          showMsg('msg-slot','Slot angelegt (wartet auf Pr√ºfung) ‚úì', true);
          e.target.reset(); recalcEnd(); fillCategoryOptions(); await loadSlots();
        }else{
          const m = {
            missing_fields:'Pflichtfelder fehlen.',
            bad_datetime:'Datum/Uhrzeit ung√ºltig.',
            end_before_start:'Ende liegt vor dem Start.',
            limit_reached:'Limit erreicht.',
            start_in_past:'Start darf nicht in der Vergangenheit liegen.',
            bad_capacity:'Kapazit√§t ung√ºltig.',
            db_constraint_error:'Kategorie entspricht nicht den DB-Vorgaben.',
            db_error:'Datenbankfehler.'
          };
          showMsg('msg-slot', m[data.error] || `Konnte Slot nicht anlegen.${data.detail ? ' ('+data.detail+')' : ''}`);
        }
      }catch(err){ showMsg('msg-slot','Netzwerkfehler.'); }
    });

    // ---------- Logout ----------
    $('#btn-logout').addEventListener('click', async ()=>{
      try{ await fetch(`${API}/auth/logout`, {method:'POST', credentials:'include'}); }catch(_){}
      location.href = 'login.html?tab=login';
    });

    // ---------- Init ----------
    (async function init(){
      await requireAuth();
      fillCategoryOptions();
      recalcEnd();
      await loadSlots();
    })();
  </script>

  <!-- Footer -->
  <footer>
    <div class="container foot-grid">
      <div>
        <div class="brand" style="margin-bottom:10px">
          <div class="brand-logo" aria-hidden="true">
            <img src="/static/terminmarktplatz-logo.png" alt="Terminmarktplatz Logo klein">
          </div>
          <div class="brand-title">Terminmarktplatz</div>
        </div>
        <p class="muted">Ein AlltagsBuddy-Projekt: smarte L√∂sungen f√ºr deinen Alltag.</p>
      </div>
      <div class="foot-col">
        <h4>Produkt</h4>
        <a class="foot-link" href="anbieter.html">F√ºr Anbieter</a>
        <a class="foot-link" href="suchende.html">F√ºr Suchende</a>
      </div>
      <div class="foot-col">
        <h4>Rechtliches</h4>
        <a class="foot-link" href="impressum.html">Impressum</a>
        <a class="foot-link" href="datenschutz.html">Datenschutz</a>
        <a class="foot-link" href="agb.html">AGB</a>
        <a class="foot-link" href="widerruf.html">Widerruf</a>
      </div>
      <div class="foot-col">
        <h4>Kontakt</h4>
        <a class="foot-link" href="kontakt.html">Kontaktformular</a>
        <a class="foot-link" href="mailto:info@terminmarktplatz.de">info@terminmarktplatz.de</a>
      </div>
    </div>
    <div class="container copyright">¬© <span id="y"></span> Terminmarktplatz ¬∑ Alle Rechte vorbehalten.</div>
  </footer>
</body>
</html>
